C51 COMPILER V9.54   MAIN                                                                  08/19/2025 22:25:06 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\Learning Programs\kiel5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT
                    -(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "LCD1602.h"
   3          #include "DS1302.h"
   4          #include "IndeKey.h"
   5          #include "Timer0_Init.h"
   6          #include "Delay.h"
   7          
   8          unsigned char KeyNum,mode,sele,TSFF;
   9          
  10          void TimeShow(){
  11   1                      DS1302_ReadTime();
  12   1                      LCD_ShowNum(1,1,DS1302_Time[0],2);
  13   1                      LCD_ShowNum(1,4,DS1302_Time[1],2);
  14   1                      LCD_ShowNum(1,7,DS1302_Time[2],2);
  15   1                      LCD_ShowNum(2,1,DS1302_Time[3],2);
  16   1                      LCD_ShowNum(2,4,DS1302_Time[4],2);
  17   1                      LCD_ShowNum(2,7,DS1302_Time[5],2);
  18   1      }
  19          
  20          void TimeSet(){
  21   1              if(KeyNum==2){
  22   2                      sele++;
  23   2                      sele%=6;
  24   2              }
  25   1              //…Ë÷√º”
  26   1              if(KeyNum==3){
  27   2                      DS1302_Time[sele]++;
  28   2                      if(DS1302_Time[0]>99){DS1302_Time[0]=0;}
  29   2                      if(DS1302_Time[1]>12){DS1302_Time[1]=1;}
  30   2                      if(DS1302_Time[1]==1 || DS1302_Time[1]==3 || DS1302_Time[1]==5 || DS1302_Time[1]==7 || DS1302_Time[1]==8
             - || DS1302_Time[1]==10 || DS1302_Time[1]==12){
  31   3                              if(DS1302_Time[2]>31){DS1302_Time[2]=1;}
  32   3                      }
  33   2                      else if(DS1302_Time[1]==4 || DS1302_Time[1]==6 || DS1302_Time[1]==9 || DS1302_Time[1]==11){
  34   3                              if(DS1302_Time[2]>30){DS1302_Time[2]=1;}
  35   3                      }
  36   2                      else if(DS1302_Time[1]==2){
  37   3                              if(DS1302_Time[0]%4==0){
  38   4                                      if(DS1302_Time[2]>29){DS1302_Time[2]=1;}
  39   4                              }
  40   3                              else{
  41   4                                      if(DS1302_Time[2]>28){DS1302_Time[2]=1;}
  42   4                              }
  43   3                      }
  44   2                      if(DS1302_Time[3]>23){DS1302_Time[3]=0;}
  45   2                      if(DS1302_Time[4]>59){DS1302_Time[4]=0;}
  46   2                      if(DS1302_Time[5]>59){DS1302_Time[5]=0;}
  47   2              }
  48   1              //…Ë÷√ºı
  49   1              if(KeyNum==4){
  50   2                      DS1302_Time[sele]--;
  51   2                      if(DS1302_Time[0]<0){DS1302_Time[0]=99;}
  52   2                      if(DS1302_Time[1]<1){DS1302_Time[1]=12;}
  53   2                      if(DS1302_Time[1]==1 || DS1302_Time[1]==3 || DS1302_Time[1]==5 || DS1302_Time[1]==7 || DS1302_Time[1]==8
C51 COMPILER V9.54   MAIN                                                                  08/19/2025 22:25:06 PAGE 2   

             - || DS1302_Time[1]==10 || DS1302_Time[1]==12){
  54   3                              if(DS1302_Time[2]<1){DS1302_Time[2]=31;}
  55   3                      }
  56   2                      else if(DS1302_Time[1]==4 || DS1302_Time[1]==6 || DS1302_Time[1]==9 || DS1302_Time[1]==11){
  57   3                              if(DS1302_Time[2]<1){DS1302_Time[2]=30;}
  58   3                      }
  59   2                      else if(DS1302_Time[1]==2){
  60   3                              if(DS1302_Time[0]%4==0){
  61   4                                      if(DS1302_Time[2]<1){DS1302_Time[2]=29;}
  62   4                              }
  63   3                              else{
  64   4                                      if(DS1302_Time[2]<1){DS1302_Time[2]=28;}
  65   4                              }
  66   3                      }
  67   2                      if(DS1302_Time[3]<0){DS1302_Time[3]=23;}
  68   2                      if(DS1302_Time[4]<0){DS1302_Time[4]=59;}
  69   2                      if(DS1302_Time[5]<0){DS1302_Time[5]=59;}
  70   2              }
  71   1              if(sele==0 && TSFF==1){LCD_ShowString(1,1,"  ");}
  72   1              else{LCD_ShowNum(1,1,DS1302_Time[0],2);}
  73   1              if(sele==1 && TSFF==1){LCD_ShowString(1,4,"  ");}
  74   1              else{LCD_ShowNum(1,4,DS1302_Time[1],2);}
  75   1              if(sele==2 && TSFF==1){LCD_ShowString(1,7,"  ");}
  76   1              else{LCD_ShowNum(1,7,DS1302_Time[2],2);}
  77   1              if(sele==3 && TSFF==1){LCD_ShowString(2,1,"  ");}
  78   1              else{LCD_ShowNum(2,1,DS1302_Time[3],2);}
  79   1              if(sele==4 && TSFF==1){LCD_ShowString(2,4,"  ");}
  80   1              else{LCD_ShowNum(2,4,DS1302_Time[4],2);}
  81   1              if(sele==5 && TSFF==1){LCD_ShowString(2,7,"  ");}
  82   1              else{LCD_ShowNum(2,7,DS1302_Time[5],2);}
  83   1              /*
  84   1              LCD_ShowNum(1,4,DS1302_Time[1],2);
  85   1              LCD_ShowNum(1,7,DS1302_Time[2],2);
  86   1              LCD_ShowNum(2,1,DS1302_Time[3],2);
  87   1              LCD_ShowNum(2,4,DS1302_Time[4],2);
  88   1              LCD_ShowNum(2,7,DS1302_Time[5],2);
  89   1              */
  90   1      }
  91          
  92          void main(){
  93   1              LCD_Init();
  94   1              DS1302_Init();
  95   1              Timer0_Init();
  96   1              LCD_ShowString(1,1,"  -  -  ");
  97   1              LCD_ShowString(2,1,"  :  :  ");
  98   1              DS1302_SetTime();
  99   1              
 100   1              while(1){
 101   2                      KeyNum=IndeKey();
 102   2                      if(KeyNum==1){
 103   3                              if(mode==1){mode=0;DS1302_SetTime();}
 104   3                              else if(mode==0){mode=1;}
 105   3                      }       
 106   2                      switch(mode){
 107   3                              case 0:TimeShow();break;
 108   3                              case 1:TimeSet();break;         
 109   3                      }
 110   2              }
 111   1      }
 112          
 113          void Timer0_Routine() interrupt 1{
 114   1              static unsigned int T0Count;
C51 COMPILER V9.54   MAIN                                                                  08/19/2025 22:25:06 PAGE 3   

 115   1              TL0=0x18;
 116   1              TH0=0xFC;
 117   1              T0Count++;
 118   1              if(T0Count>=500){
 119   2                      T0Count=0;
 120   2                      TSFF=!TSFF;
 121   2              }
 122   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    927    ----
   CONSTANT SIZE    =     21    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
